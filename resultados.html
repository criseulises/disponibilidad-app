<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Disponibilidades</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .view-controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 10px 20px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .view-btn:hover:not(.active) {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Vista por Persona */
        .people-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .person-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .person-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }

        .person-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .person-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .person-total {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .day-name {
            font-weight: 600;
            color: #333;
            min-width: 80px;
        }

        .time-range {
            color: #666;
            font-family: 'Courier New', monospace;
        }

        /* Vista por D√≠a */
        .days-view {
            display: none;
        }

        .days-view.active {
            display: block;
        }

        .day-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .day-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .day-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .day-count {
            background: #28a745;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .people-in-day {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .person-in-day {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 18px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .person-name-small {
            font-weight: 600;
            color: #333;
        }

        /* Vista de Conflictos/Coincidencias */
        .conflicts-view {
            display: none;
        }

        .conflicts-view.active {
            display: block;
        }

        .conflict-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .conflict-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .conflict-time {
            background: #ff6b6b;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .conflict-day {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .conflict-people {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .conflict-person {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #e9ecef;
            font-weight: 500;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .view-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .people-grid {
                grid-template-columns: 1fr;
            }
            
            .people-in-day {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä An√°lisis de Disponibilidades</h1>
        
        <div class="stats-section" id="statsSection">
            <!-- Las estad√≠sticas se generar√°n aqu√≠ -->
        </div>

        <div class="view-controls">
            <button class="view-btn active" onclick="setView('people')">üë• Por Persona</button>
            <button class="view-btn" onclick="setView('days')">üìÖ Por D√≠a</button>
            <button class="view-btn" onclick="setView('conflicts')">‚ö†Ô∏è Coincidencias</button>
            <input type="text" class="search-box" id="searchBox" placeholder="üîç Buscar persona..." 
                   oninput="filterResults()">
        </div>

        <!-- Vista por Personas -->
        <div class="people-view active" id="peopleView">
            <div class="people-grid" id="peopleGrid">
                <!-- Las tarjetas de personas se generar√°n aqu√≠ -->
            </div>
        </div>

        <!-- Vista por D√≠as -->
        <div class="days-view" id="daysView">
            <div id="daysContainer">
                <!-- Los d√≠as se generar√°n aqu√≠ -->
            </div>
        </div>

        <!-- Vista de Conflictos -->
        <div class="conflicts-view" id="conflictsView">
            <div id="conflictsContainer">
                <!-- Los conflictos se generar√°n aqu√≠ -->
            </div>
        </div>
    </div>

    <script>
        // Datos de las disponibilidades cargados directamente
        const availabilityData = {
            "Joerlyn Morfe": {
                "Lunes": [{"desde": "22:00", "hasta": "23:00", "desde_formateado": "10:00 PM", "hasta_formateado": "11:00 PM"}],
                "Martes": [
                    {"desde": "22:00", "hasta": "23:00", "desde_formateado": "10:00 PM", "hasta_formateado": "11:00 PM"},
                    {"desde": "03:00", "hasta": "04:00", "desde_formateado": "03:00 AM", "hasta_formateado": "04:00 AM"}
                ],
                "Mi√©rcoles": [{"desde": "19:00", "hasta": "23:00", "desde_formateado": "07:00 PM", "hasta_formateado": "11:00 PM"}],
                "Jueves": [{"desde": "19:00", "hasta": "23:00", "desde_formateado": "07:00 PM", "hasta_formateado": "11:00 PM"}],
                "Viernes": [{"desde": "20:00", "hasta": "23:00", "desde_formateado": "08:00 PM", "hasta_formateado": "11:00 PM"}],
                "S√°bado": [{"desde": "10:00", "hasta": "12:00", "desde_formateado": "10:00 AM", "hasta_formateado": "12:00 PM"}],
                "Domingo": [{"desde": "16:00", "hasta": "17:00", "desde_formateado": "04:00 PM", "hasta_formateado": "05:00 PM"}]
            },
            "Geremy Jose Ferran Ferreras": {
                "Lunes": [{"desde": "20:00", "hasta": "22:00", "desde_formateado": "08:00 PM", "hasta_formateado": "10:00 PM"}],
                "Martes": [{"desde": "21:00", "hasta": "22:00", "desde_formateado": "09:00 PM", "hasta_formateado": "10:00 PM"}],
                "Mi√©rcoles": [{"desde": "20:00", "hasta": "22:00", "desde_formateado": "08:00 PM", "hasta_formateado": "10:00 PM"}],
                "Jueves": [{"desde": "21:00", "hasta": "22:00", "desde_formateado": "09:00 PM", "hasta_formateado": "10:00 PM"}],
                "Viernes": [{"desde": "20:00", "hasta": "22:00", "desde_formateado": "08:00 PM", "hasta_formateado": "10:00 PM"}]
            },
            "Gary A. Campusano P.": {
                "Martes": [{"desde": "22:00", "hasta": "23:00", "desde_formateado": "10:00 PM", "hasta_formateado": "11:00 PM"}],
                "Mi√©rcoles": [{"desde": "22:00", "hasta": "23:00", "desde_formateado": "10:00 PM", "hasta_formateado": "11:00 PM"}],
                "Jueves": [{"desde": "22:00", "hasta": "23:00", "desde_formateado": "10:00 PM", "hasta_formateado": "11:00 PM"}]
            },
            "Roylin Enrique Rodriguez Jimenez": {
                "Martes": [{"desde": "19:00", "hasta": "20:00", "desde_formateado": "07:00 PM", "hasta_formateado": "08:00 PM"}],
                "Jueves": [{"desde": "19:00", "hasta": "20:00", "desde_formateado": "07:00 PM", "hasta_formateado": "08:00 PM"}],
                "Viernes": [{"desde": "21:00", "hasta": "22:00", "desde_formateado": "09:00 PM", "hasta_formateado": "10:00 PM"}],
                "S√°bado": [{"desde": "12:00", "hasta": "18:00", "desde_formateado": "12:00 PM", "hasta_formateado": "06:00 PM"}]
            },
            "Ninel Gissel Feliz Rosario": {
                "Martes": [{"desde": "08:00", "hasta": "14:00", "desde_formateado": "08:00 AM", "hasta_formateado": "02:00 PM"}],
                "Mi√©rcoles": [{"desde": "08:00", "hasta": "14:00", "desde_formateado": "08:00 AM", "hasta_formateado": "02:00 PM"}],
                "Jueves": [{"desde": "08:00", "hasta": "14:00", "desde_formateado": "08:00 AM", "hasta_formateado": "02:00 PM"}],
                "Viernes": [{"desde": "23:00", "hasta": "12:00", "desde_formateado": "11:00 PM", "hasta_formateado": "12:00 PM"}],
                "S√°bado": [{"desde": "21:00", "hasta": "12:00", "desde_formateado": "09:00 PM", "hasta_formateado": "12:00 PM"}],
                "Domingo": [{"desde": "13:00", "hasta": "22:00", "desde_formateado": "01:00 PM", "hasta_formateado": "10:00 PM"}]
            },
            "Axel Soto": {
                "Lunes": [{"desde": "19:00", "hasta": "21:00", "desde_formateado": "07:00 PM", "hasta_formateado": "09:00 PM"}],
                "S√°bado": [{"desde": "04:00", "hasta": "23:00", "desde_formateado": "04:00 AM", "hasta_formateado": "11:00 PM"}]
            },
            "Emmanuel Espinal": {
                "Lunes": [{"desde": "22:30", "hasta": "23:00", "desde_formateado": "10:30 PM", "hasta_formateado": "11:00 PM"}],
                "Martes": [{"desde": "20:30", "hasta": "23:00", "desde_formateado": "08:30 PM", "hasta_formateado": "11:00 PM"}],
                "Mi√©rcoles": [{"desde": "22:30", "hasta": "23:00", "desde_formateado": "10:30 PM", "hasta_formateado": "11:00 PM"}],
                "Jueves": [{"desde": "20:30", "hasta": "23:00", "desde_formateado": "08:30 PM", "hasta_formateado": "11:00 PM"}],
                "Viernes": [{"desde": "22:30", "hasta": "23:00", "desde_formateado": "10:30 PM", "hasta_formateado": "11:00 PM"}],
                "S√°bado": [{"desde": "18:00", "hasta": "23:00", "desde_formateado": "06:00 PM", "hasta_formateado": "11:00 PM"}]
            },
            "Yahinniel Vasquez": {
                "Martes": [{"desde": "02:00", "hasta": "22:00", "desde_formateado": "02:00 AM", "hasta_formateado": "10:00 PM"}],
                "Jueves": [{"desde": "02:00", "hasta": "22:00", "desde_formateado": "02:00 AM", "hasta_formateado": "10:00 PM"}],
                "S√°bado": [
                    {"desde": "09:00", "hasta": "14:00", "desde_formateado": "09:00 AM", "hasta_formateado": "02:00 PM"},
                    {"desde": "18:00", "hasta": "23:00", "desde_formateado": "06:00 PM", "hasta_formateado": "11:00 PM"}
                ],
                "Domingo": [{"desde": "08:00", "hasta": "23:00", "desde_formateado": "08:00 AM", "hasta_formateado": "11:00 PM"}]
            },
            "Cristian Sanchez": {
                // Lunes: Disponible excepto F√≠sica General II (2:00-5:00 PM), L√≥gica Matem√°tica (6:00-8:00 PM), Conmutaci√≥n (8:00-10:00 PM)
                "Lunes": [
                    {"desde": "08:00", "hasta": "14:00", "desde_formateado": "08:00 AM", "hasta_formateado": "02:00 PM"},
                    {"desde": "17:00", "hasta": "18:00", "desde_formateado": "05:00 PM", "hasta_formateado": "06:00 PM"},
                    {"desde": "22:00", "hasta": "23:59", "desde_formateado": "10:00 PM", "hasta_formateado": "11:59 PM"}
                ],
                // Martes: Disponible excepto F√≠sica General II Lab (4:00-7:00 PM)
                "Martes": [
                    {"desde": "08:00", "hasta": "16:00", "desde_formateado": "08:00 AM", "hasta_formateado": "04:00 PM"},
                    {"desde": "19:00", "hasta": "23:59", "desde_formateado": "07:00 PM", "hasta_formateado": "11:59 PM"}
                ],
                // Mi√©rcoles: Disponible excepto C√°lculo Vectorial (4:00-6:00 PM), L√≥gica Matem√°tica (6:00-8:00 PM)
                "Mi√©rcoles": [
                    {"desde": "08:00", "hasta": "16:00", "desde_formateado": "08:00 AM", "hasta_formateado": "04:00 PM"},
                    {"desde": "20:00", "hasta": "23:59", "desde_formateado": "08:00 PM", "hasta_formateado": "11:59 PM"}
                ],
                // Jueves: Disponible excepto Proyecto Integrador I (10:00 AM - 1:00 PM)
                "Jueves": [
                    {"desde": "08:00", "hasta": "10:00", "desde_formateado": "08:00 AM", "hasta_formateado": "10:00 AM"},
                    {"desde": "13:00", "hasta": "23:59", "desde_formateado": "01:00 PM", "hasta_formateado": "11:59 PM"}
                ],
                // Viernes: Disponible excepto C√°lculo Vectorial (4:00-6:00 PM), Fundamentos de Ciberseguridad (6:00-8:00 PM), Formulaci√≥n de Negocios (8:00 PM)
                "Viernes": [
                    {"desde": "08:00", "hasta": "16:00", "desde_formateado": "08:00 AM", "hasta_formateado": "04:00 PM"}
                ],
                // S√°bado: Disponible excepto Fundamentos de Ciberseguridad (12:00-2:00 PM)
                "S√°bado": [
                    {"desde": "08:00", "hasta": "12:00", "desde_formateado": "08:00 AM", "hasta_formateado": "12:00 PM"},
                    {"desde": "14:00", "hasta": "23:59", "desde_formateado": "02:00 PM", "hasta_formateado": "11:59 PM"}
                ],
                // Domingo: Completamente disponible
                "Domingo": [
                    {"desde": "08:00", "hasta": "23:59", "desde_formateado": "08:00 AM", "hasta_formateado": "11:59 PM"}
                ]
            }
        };

        let currentView = 'people';
        let filteredData = availabilityData;

        function generateStats() {
            const totalPeople = Object.keys(availabilityData).length;
            let totalSlots = 0;
            let daysWithAvailability = new Set();
            
            Object.values(availabilityData).forEach(person => {
                Object.entries(person).forEach(([day, slots]) => {
                    totalSlots += slots.length;
                    daysWithAvailability.add(day);
                });
            });

            const statsContainer = document.getElementById('statsSection');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalPeople}</div>
                    <div class="stat-label">Personas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalSlots}</div>
                    <div class="stat-label">Horarios Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${daysWithAvailability.size}</div>
                    <div class="stat-label">D√≠as Cubiertos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalSlots / totalPeople)}</div>
                    <div class="stat-label">Promedio por Persona</div>
                </div>
            `;
        }

        function setView(view) {
            currentView = view;
            
            // Actualizar botones
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Ocultar todas las vistas
            document.querySelectorAll('.people-view, .days-view, .conflicts-view').forEach(v => {
                v.classList.remove('active');
                v.style.display = 'none';
            });
            
            // Mostrar vista seleccionada
            const viewElement = document.getElementById(view + 'View');
            viewElement.style.display = 'block';
            viewElement.classList.add('active');
            
            // Generar contenido seg√∫n la vista
            switch(view) {
                case 'people':
                    generatePeopleView();
                    break;
                case 'days':
                    generateDaysView();
                    break;
                case 'conflicts':
                    generateConflictsView();
                    break;
            }
        }

        function generatePeopleView() {
            const container = document.getElementById('peopleGrid');
            container.innerHTML = '';
            
            Object.entries(filteredData).forEach(([personName, schedule]) => {
                let totalSlots = 0;
                let scheduleHTML = '';
                
                Object.entries(schedule).forEach(([day, slots]) => {
                    totalSlots += slots.length;
                    slots.forEach(slot => {
                        scheduleHTML += `
                            <div class="schedule-item">
                                <span class="day-name">${day}</span>
                                <span class="time-range">${slot.desde_formateado} - ${slot.hasta_formateado}</span>
                            </div>
                        `;
                    });
                });
                
                container.innerHTML += `
                    <div class="person-card">
                        <div class="person-header">
                            <div class="person-name">${personName}</div>
                            <div class="person-total">${totalSlots} horarios</div>
                        </div>
                        <div class="schedule-list">
                            ${scheduleHTML}
                        </div>
                    </div>
                `;
            });
        }

        function generateDaysView() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = '';
            
            const dayOrder = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
            const dayData = {};
            
            // Organizar por d√≠as
            Object.entries(filteredData).forEach(([personName, schedule]) => {
                Object.entries(schedule).forEach(([day, slots]) => {
                    if (!dayData[day]) dayData[day] = [];
                    slots.forEach(slot => {
                        dayData[day].push({
                            person: personName,
                            ...slot
                        });
                    });
                });
            });
            
            dayOrder.forEach(day => {
                if (dayData[day]) {
                    const daySlots = dayData[day];
                    let peopleHTML = '';
                    
                    daySlots.forEach(slot => {
                        peopleHTML += `
                            <div class="person-in-day">
                                <span class="person-name-small">${slot.person}</span>
                                <span class="time-range">${slot.desde_formateado} - ${slot.hasta_formateado}</span>
                            </div>
                        `;
                    });
                    
                    container.innerHTML += `
                        <div class="day-section">
                            <div class="day-header">
                                <div class="day-title">${day}</div>
                                <div class="day-count">${daySlots.length} horarios</div>
                            </div>
                            <div class="people-in-day">
                                ${peopleHTML}
                            </div>
                        </div>
                    `;
                }
            });
        }

        function generateConflictsView() {
            const container = document.getElementById('conflictsContainer');
            container.innerHTML = '';
            
            const conflicts = findTimeConflicts();
            
            if (conflicts.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        ‚úÖ No se encontraron conflictos de horarios.<br>
                        Todas las personas tienen horarios √∫nicos.
                    </div>
                `;
                return;
            }
            
            conflicts.forEach(conflict => {
                let peopleHTML = '';
                conflict.people.forEach(person => {
                    peopleHTML += `<div class="conflict-person">${person}</div>`;
                });
                
                container.innerHTML += `
                    <div class="conflict-section">
                        <div class="conflict-header">
                            <div class="conflict-day">${conflict.day}</div>
                            <div class="conflict-time">${conflict.timeRange}</div>
                        </div>
                        <div class="conflict-people">
                            ${peopleHTML}
                        </div>
                    </div>
                `;
            });
        }

        function findTimeConflicts() {
            const conflicts = [];
            const dayOrder = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
            
            dayOrder.forEach(day => {
                const daySchedules = [];
                
                Object.entries(filteredData).forEach(([personName, schedule]) => {
                    if (schedule[day]) {
                        schedule[day].forEach(slot => {
                            daySchedules.push({
                                person: personName,
                                from: slot.desde,
                                to: slot.hasta,
                                fromFormatted: slot.desde_formateado,
                                toFormatted: slot.hasta_formateado
                            });
                        });
                    }
                });
                
                // Buscar superposiciones
                for (let i = 0; i < daySchedules.length; i++) {
                    for (let j = i + 1; j < daySchedules.length; j++) {
                        const slot1 = daySchedules[i];
                        const slot2 = daySchedules[j];
                        
                        if (timesOverlap(slot1.from, slot1.to, slot2.from, slot2.to)) {
                            const existingConflict = conflicts.find(c => 
                                c.day === day && 
                                c.timeRange === `${slot1.fromFormatted} - ${slot1.toFormatted}`
                            );
                            
                            if (existingConflict) {
                                if (!existingConflict.people.includes(slot2.person)) {
                                    existingConflict.people.push(slot2.person);
                                }
                            } else {
                                conflicts.push({
                                    day: day,
                                    timeRange: `${slot1.fromFormatted} - ${slot1.toFormatted}`,
                                    people: [slot1.person, slot2.person]
                                });
                            }
                        }
                    }
                }
            });
            
            return conflicts;
        }

        function timesOverlap(start1, end1, start2, end2) {
            return start1 < end2 && start2 < end1;
        }

        function generateOptimalView() {
            const slider = document.getElementById('thresholdSlider');
            const minParticipants = parseInt(slider.value);
            updateOptimalView();
        }

        function updateOptimalView() {
            const slider = document.getElementById('thresholdSlider');
            const minParticipants = parseInt(slider.value);
            const totalPeople = Object.keys(filteredData).length;
            
            // Actualizar label del slider
            const percentage = Math.round((minParticipants / totalPeople) * 100);
            document.getElementById('currentThreshold').textContent = `${minParticipants} personas (${percentage}%)`;
            
            const optimalTimes = findOptimalTimes(minParticipants);
            const container = document.getElementById('optimalContainer');
            
            if (optimalTimes.length === 0) {
                container.innerHTML = `
                    <div class="no-optimal-times">
                        üòî No se encontraron horarios donde puedan asistir al menos ${minParticipants} personas.<br>
                        Intente reducir el n√∫mero m√≠nimo de participantes.
                    </div>
                `;
                return;
            }
            
            // Ordenar por n√∫mero de participantes (descendente) y luego por d√≠a
            optimalTimes.sort((a, b) => {
                if (b.participants.length !== a.participants.length) {
                    return b.participants.length - a.participants.length;
                }
                const dayOrder = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
                return dayOrder.indexOf(a.day) - dayOrder.indexOf(b.day);
            });
            
            let html = '';
            
            optimalTimes.forEach(timeSlot => {
                const participantCount = timeSlot.participants.length;
                const percentage = Math.round((participantCount / totalPeople) * 100);
                
                // Determinar clase CSS seg√∫n el porcentaje
                let sectionClass = 'optimal-section';
                let badgeClass = 'participation-count';
                
                if (percentage === 100) {
                    sectionClass += ' perfect-match';
                    badgeClass += ' perfect';
                } else if (percentage >= 75) {
                    sectionClass += ' excellent-match';
                    badgeClass += ' excellent';
                } else if (percentage >= 50) {
                    sectionClass += ' good-match';
                    badgeClass += ' good';
                }
                
                let participantsHTML = '';
                timeSlot.participants.forEach(participant => {
                    participantsHTML += `<div class="optimal-participant">${participant}</div>`;
                });
                
                html += `
                    <div class="${sectionClass}">
                        <div class="optimal-header">
                            <div class="optimal-time-info">
                                <div class="optimal-day">${timeSlot.day}</div>
                                <div class="optimal-time">${timeSlot.timeRange}</div>
                            </div>
                            <div class="participation-badge">
                                <div class="${badgeClass}">${participantCount}/${totalPeople}</div>
                                <div class="participation-percentage">${percentage}%</div>
                            </div>
                        </div>
                        <div class="optimal-participants">
                            ${participantsHTML}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function findOptimalTimes(minParticipants) {
            const optimalTimes = [];
            const dayOrder = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
            
            dayOrder.forEach(day => {
                // Recopilar todos los intervalos de tiempo para este d√≠a
                const dayIntervals = [];
                
                Object.entries(filteredData).forEach(([personName, schedule]) => {
                    if (schedule[day]) {
                        schedule[day].forEach(slot => {
                            dayIntervals.push({
                                person: personName,
                                start: timeToMinutes(slot.desde),
                                end: timeToMinutes(slot.hasta),
                                startFormatted: slot.desde_formateado,
                                endFormatted: slot.hasta_formateado,
                                originalSlot: slot
                            });
                        });
                    }
                });
                
                if (dayIntervals.length < minParticipants) return;
                
                // Encontrar intersecciones de tiempo donde coincidan m√∫ltiples personas
                const intersections = findTimeIntersections(dayIntervals, minParticipants);
                
                intersections.forEach(intersection => {
                    if (intersection.participants.length >= minParticipants) {
                        optimalTimes.push({
                            day: day,
                            timeRange: `${intersection.startFormatted} - ${intersection.endFormatted}`,
                            participants: intersection.participants,
                            startTime: intersection.start,
                            endTime: intersection.end
                        });
                    }
                });
            });
            
            return optimalTimes;
        }

        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function minutesToTimeFormatted(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHour = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;
            return `${displayHour.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')} ${ampm}`;
        }

        function findTimeIntersections(intervals, minParticipants) {
            if (intervals.length < minParticipants) return [];
            
            const intersections = [];
            
            // Crear una lista de todos los puntos de tiempo √∫nicos
            const timePoints = new Set();
            intervals.forEach(interval => {
                timePoints.add(interval.start);
                timePoints.add(interval.end);
            });
            
            const sortedTimePoints = Array.from(timePoints).sort((a, b) => a - b);
            
            // Para cada par de puntos consecutivos, verificar cu√°ntas personas est√°n disponibles
            for (let i = 0; i < sortedTimePoints.length - 1; i++) {
                const start = sortedTimePoints[i];
                const end = sortedTimePoints[i + 1];
                
                const availablePeople = [];
                
                intervals.forEach(interval => {
                    // Verificar si este intervalo incluye completamente el per√≠odo [start, end]
                    if (interval.start <= start && interval.end >= end) {
                        availablePeople.push(interval.person);
                    }
                });
                
                if (availablePeople.length >= minParticipants) {
                    // Verificar si ya tenemos esta intersecci√≥n
                    const existing = intersections.find(inter => 
                        inter.start === start && 
                        inter.end === end &&
                        arraysEqual(inter.participants.sort(), availablePeople.sort())
                    );
                    
                    if (!existing) {
                        intersections.push({
                            start: start,
                            end: end,
                            startFormatted: minutesToTimeFormatted(start),
                            endFormatted: minutesToTimeFormatted(end),
                            participants: [...new Set(availablePeople)].sort()
                        });
                    }
                }
            }
            
            return intersections;
        }

        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, index) => val === b[index]);
        }

        function filterResults() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            if (searchTerm === '') {
                filteredData = availabilityData;
            } else {
                filteredData = {};
                Object.entries(availabilityData).forEach(([personName, schedule]) => {
                    if (personName.toLowerCase().includes(searchTerm)) {
                        filteredData[personName] = schedule;
                    }
                });
            }
            
            // Regenerar la vista actual
            setView(currentView);
        }

        // Inicializar la aplicaci√≥n
        function init() {
            generateStats();
            generatePeopleView();
        }

        // Inicializar cuando la p√°gina se carga
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>